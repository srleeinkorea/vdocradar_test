<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V-Doc Radar (브이닥 레이더) - 청구 사전 심사 웹앱</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons (선택 사항이지만 디자인을 위해 유지) -->
    <!-- React 및 Babel 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* 기본 폰트 설정 및 배경 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Gray-900 */
        }
        /* 테이블 헤더의 마우스 오버 시 정렬 아이콘 보이게 처리 */
        .header-sort-icon {
            opacity: 0;
            transition: opacity 0.15s;
        }
        .header-col:hover .header-sort-icon {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Lucide Icons SVG (CDN 환경에서 직접 임포트가 불가능하여 SVG로 대체)
        const Zap = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const AlertTriangle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
        const CheckCircle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const Search = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>;
        const ChevronDown = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;
        
        const { useState, useEffect, useMemo } = React;

        // --- MOCK DATA (모의 데이터) ---
        // 실제 심사에서 흔히 발생하는 '횟수 초과', '기준 충족', '서류 미비' 사례를 반영했습니다.
        const mockScreeningHistory = [
            {
                id: '4315',
                사용자코드: '4315',
                청구코드: 'F8011',
                코드명: '신경인지기능검사(풀배터리)-개별',
                청구항목: '특정내역',
                구분: '삭감경고',
                처리방법: '◎ [횟수 기준 불만족] 심사기준 고시 제2023-300호에 따라, 검사 시행 횟수가 6개월 기준 2회를 초과했습니다. 재청구 시 사유서 제출 필요.',
                simsaStatus: '삭감경고', // Screening Status
                simsaResultText: '[재검사 횟수 초과] 해당 청구 건은 6개월 이내 2회를 초과하여 청구되었습니다. 심사 기준을 초과함.',
                extensionCriteria: '고시명: 2023-300 신경인지기능검사 인정기준. 기준: 6개월당 2회 한정. 초과 시 사유서 필수.',
                diagnosisCodes: [
                    { code: 'G30.9', name: '알츠하이머병, 상세불명' },
                    { code: 'F03', name: '상세불명의 치매' },
                ],
            },
            {
                id: '4316',
                사용자코드: '4316',
                청구코드: 'P1230',
                코드명: '복강경하 담낭절제술(단일절개)',
                청구항목: '예외',
                구분: '심사완료',
                처리방법: '정상적으로 심사가 완료되었으며, 특이사항이 발견되지 않았습니다. (고시 제2023-500호 기준 충족)',
                simsaStatus: '심사완료',
                simsaResultText: '수술 난이도 및 진단명(K80.1) 기준 충족. 정상 심사 완료되었습니다.',
                extensionCriteria: '고시명: 2023-500 단일절개 복강경 수술 인정기준. 연장 기준: 해당 없음.',
                diagnosisCodes: [
                    { code: 'K80.1', name: '담낭의 결석을 동반한 만성 담낭염' },
                ],
            },
            {
                id: '4317',
                사용자코드: '4317',
                청구코드: 'J1023',
                코드명: '약물치료관리료(내과)',
                청구항목: '특정내역',
                구분: '보류',
                처리방법: '세부 내역 검토를 위해 보류되었습니다. [특정내역: MA-001]에 의거, 요양급여 청구 시 상담 시간을 포함한 세부 진료기록 사본 제출 요망.',
                simsaStatus: '보류',
                simsaResultText: '[특정내역 불충분] 환자 교육 및 상담 시간 기록(총 30분 이상) 확인 불가. 관련 서류 추가 제출 필요.',
                extensionCriteria: '고시명: 카-121 약물치료관리료. 연장 기준: 관련 지침을 확인하세요.',
                diagnosisCodes: [
                    { code: 'I10', name: '일차성(본태성) 고혈압' },
                ],
            },
        ];

        const mockNotices = [
            { date: '2023-11-20', noticeNum: '2023-300', noticeName: '신경인지기능검사 인정기준', noticeDetail: '심사기준 확인' },
            { date: '2023-01-01', noticeNum: '2023-500', noticeName: '단일절개 복강경 수술 인정기준', noticeDetail: '수술기준 확인' },
        ];
        // --- /MOCK DATA ---

        // Custom component for the status badge
        const StatusBadge = ({ status }) => {
            let colorClass = '';
            let Icon = null;

            switch (status) {
                case '삭감경고':
                    colorClass = 'bg-red-500/20 text-red-400 border-red-500';
                    Icon = AlertTriangle;
                    break;
                case '심사완료':
                    colorClass = 'bg-green-500/20 text-green-400 border-green-500';
                    Icon = CheckCircle;
                    break;
                case '보류':
                    colorClass = 'bg-yellow-500/20 text-yellow-400 border-yellow-500';
                    Icon = Zap;
                    break;
                default:
                    colorClass = 'bg-gray-500/20 text-gray-400 border-gray-500';
                    Icon = Search;
            }

            return (
                <span className={`inline-flex items-center gap-1.5 px-3 py-1 text-xs font-semibold rounded-full border ${colorClass}`}>
                    {Icon && <Icon size={14} />}
                    {status}
                </span>
            );
        };

        const Header = () => (
            <header className="flex justify-between items-center p-4 bg-gray-900 border-b border-gray-700 shadow-lg">
                <div className="flex items-center gap-3">
                    <Zap className="text-red-400 w-7 h-7" />
                    <h1 className="text-2xl font-bold text-white">V-Doc Radar (브이닥 레이더) V2.0</h1>
                </div>
                <div className="flex items-center space-x-2">
                    <button className="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition duration-150 shadow-md">
                        <Search className="w-4 h-4 mr-1" />
                        새 심사 (F6)
                    </button>
                    <button className="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 transition duration-150 shadow-md">
                        저장 (F7)
                    </button>
                    <button className="px-4 py-2 text-sm font-medium text-white bg-gray-700 rounded-md hover:bg-gray-600 transition duration-150 shadow-md">
                        닫기 (F8)
                    </button>
                </div>
            </header>
        );

        const App = () => {
            const [history, setHistory] = useState(mockScreeningHistory);
            const [selectedItem, setSelectedItem] = useState(mockScreeningHistory[0]);

            // Function to handle row selection
            const handleSelectRow = (item) => {
                setSelectedItem(item);
            };

            // --- Components for Sections ---

            // 1. Top Section: Screening History Table
            const ScreeningHistory = () => (
                <div className="flex flex-col h-full">
                    <h2 className="text-lg font-semibold text-gray-100 p-3 bg-gray-800 border-b border-gray-700 rounded-t-lg">심사 내역</h2>
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-700 text-sm">
                            <thead className="bg-gray-700">
                                <tr>
                                    {['ID', '사용자코드', '청구코드', '코드명', '청구항목', '구분', '처리방법'].map((header) => (
                                        <th key={header} className="header-col px-4 py-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer transition">
                                            <div className="flex items-center">{header} <ChevronDown className="header-sort-icon w-3 h-3 ml-1" /></div>
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody className="bg-gray-800 divide-y divide-gray-700">
                                {history.map((item) => (
                                    <tr
                                        key={item.id}
                                        className={`cursor-pointer hover:bg-gray-600 transition ${selectedItem.id === item.id ? 'bg-blue-800/50 border-l-4 border-blue-500' : ''}`}
                                        onClick={() => handleSelectRow(item)}
                                    >
                                        <td className="px-4 py-2 whitespace-nowrap font-medium text-gray-200">{item.id}</td>
                                        <td className="px-4 py-2 whitespace-nowrap text-gray-300">{item.사용자코드}</td>
                                        <td className="px-4 py-2 whitespace-nowrap text-gray-300">{item.청구코드}</td>
                                        <td className="px-4 py-2 text-gray-300 max-w-xs truncate">{item.코드명}</td>
                                        <td className="px-4 py-2 whitespace-nowrap text-gray-300">{item.청구항목}</td>
                                        <td className="px-4 py-2 whitespace-nowrap">
                                            <StatusBadge status={item.구분} />
                                        </td>
                                        <td className="px-4 py-2 text-gray-300 max-w-xs truncate">{item.처리방법}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            // 2. Bottom Left: Detail and Extension Criteria
            const DetailSection = () => (
                <div className="flex flex-col space-y-4 p-4 bg-gray-800 rounded-lg shadow-xl h-full">
                    <div className="grid grid-cols-2 gap-3 text-sm">
                        <div className="flex flex-col">
                            <label className="text-gray-400 font-medium">사용자코드</label>
                            <input type="text" readOnly value={selectedItem.사용자코드 || ''} className="bg-gray-700 border border-gray-600 p-2 rounded text-gray-100" />
                        </div>
                        <div className="flex flex-col">
                            <label className="text-gray-400 font-medium">청구코드</label>
                            <input type="text" readOnly value={selectedItem.청구코드 || ''} className="bg-gray-700 border border-gray-600 p-2 rounded text-gray-100" />
                        </div>
                        <div className="flex flex-col col-span-2">
                            <label className="text-gray-400 font-medium">코드명</label>
                            <input type="text" readOnly value={selectedItem.코드명 || ''} className="bg-gray-700 border border-gray-600 p-2 rounded text-gray-100" />
                        </div>
                        <div className="flex flex-col col-span-2">
                            <label className="text-gray-400 font-medium">특정내역</label>
                            <input type="text" readOnly value={selectedItem.청구항목 || ''} className={`p-2 rounded font-bold ${selectedItem.구분 === '삭감경고' ? 'bg-red-500 text-white' : 'bg-gray-700 text-gray-100'}`} />
                        </div>
                    </div>

                    <div className="border-t border-gray-700 pt-4">
                        <h3 className="text-lg font-semibold text-gray-100 mb-2">연장 기준</h3>
                        <p className="text-xs text-gray-300 mb-3">{selectedItem.extensionCriteria}</p>

                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead className="bg-gray-700">
                                    <tr>
                                        {['구분', '고시번호', '고시명', '고시내용'].map((h) => (
                                            <th key={h} className="px-2 py-1 text-left text-xs font-medium text-gray-300">{h}</th>
                                        ))}
                                        <th className="px-2 py-1 text-left text-xs font-medium text-gray-300">상세보기</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-gray-800 divide-y divide-gray-700">
                                    {mockNotices.filter(n => selectedItem.extensionCriteria.includes(n.noticeName) || selectedItem.extensionCriteria.includes(n.noticeNum)).map((notice, index) => (
                                        <tr key={index}>
                                            <td className="px-2 py-1 text-gray-300">고시</td>
                                            <td className="px-2 py-1 text-gray-300">{notice.noticeNum}</td>
                                            <td className="px-2 py-1 text-gray-300">{notice.noticeName}</td>
                                            <td className="px-2 py-1 text-blue-400 cursor-pointer hover:underline">{notice.noticeDetail}</td>
                                            <td className="px-2 py-1">
                                                <button className="text-xs text-blue-400 hover:text-blue-300">상세내역</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );

            // 3. Bottom Middle: Screening Result/Warning
            const ResultSection = () => (
                <div className="flex flex-col space-y-4 p-4 bg-gray-800 rounded-lg shadow-xl h-full">
                    <h3 className="text-lg font-semibold text-gray-100">심사 결과</h3>
                    <div className={`p-3 rounded-md shadow-inner transition duration-300 ${
                        selectedItem.simsaStatus === '삭감경고' ? 'bg-red-900/40 border border-red-500' :
                        selectedItem.simsaStatus === '심사완료' ? 'bg-green-900/40 border border-green-500' :
                        'bg-yellow-900/40 border border-yellow-500'
                    }`}>
                        <div className="flex items-center mb-2">
                            <StatusBadge status={selectedItem.simsaStatus} />
                            <span className="ml-3 font-bold text-lg text-white">{selectedItem.simsaStatus}</span>
                        </div>
                        <p className="text-sm text-gray-200 mt-2">{selectedItem.simsaResultText}</p>
                    </div>

                    <div className="flex flex-col flex-grow">
                        <h3 className="text-lg font-semibold text-gray-100 mb-2">처리 방법</h3>
                        <textarea
                            readOnly
                            value={selectedItem.처리방법 || ''}
                            className="flex-grow bg-gray-700 border border-gray-600 p-3 rounded text-gray-100 text-sm resize-none"
                            rows={6}
                        />
                    </div>
                </div>
            );

            // 4. Bottom Right: Diagnosis (불만정상병)
            const DiagnosisSection = () => (
                <div className="flex flex-col space-y-4 p-4 bg-gray-800 rounded-lg shadow-xl h-full">
                    <h3 className="text-lg font-semibold text-gray-100 mb-2">불만정상병</h3>
                    <div className="overflow-y-auto flex-grow">
                        <table className="w-full text-sm">
                            <thead className="bg-gray-700 sticky top-0">
                                <tr>
                                    <th className="px-3 py-2 text-left text-xs font-medium text-gray-300 w-1/4">구분</th>
                                    <th className="px-3 py-2 text-left text-xs font-medium text-gray-300 w-1/4">상병코드</th>
                                    <th className="px-3 py-2 text-left text-xs font-medium text-gray-300 w-1/2">상병</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-700">
                                {selectedItem.diagnosisCodes && selectedItem.diagnosisCodes.map((diag, index) => (
                                    <tr key={index} className="hover:bg-gray-700 transition">
                                        <td className="px-3 py-2 text-gray-300">주상병</td>
                                        <td className="px-3 py-2 text-gray-300 font-mono">{diag.code}</td>
                                        <td className="px-3 py-2 text-gray-200">{diag.name}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );

            if (!selectedItem) return <div className="text-center p-8 text-white">데이터 로딩 중...</div>;

            return (
                <div className="min-h-screen bg-gray-900 font-sans text-white flex flex-col">
                    <Header />
                    
                    {/* Main Content Area */}
                    <main className="p-4 flex-grow overflow-hidden">
                        <div className="h-full flex flex-col space-y-4">
                            
                            {/* Top Section: History Table */}
                            <div className="flex-none h-1/3 min-h-[200px] border border-gray-700 rounded-lg overflow-hidden">
                                <ScreeningHistory />
                            </div>

                            {/* Bottom Section: Details, Result, Diagnosis (3 columns) */}
                            <div className="flex-grow grid grid-cols-1 lg:grid-cols-3 gap-4 min-h-[400px]">
                                <div className="lg:col-span-1 border border-gray-700 rounded-lg p-3">
                                    <h2 className="text-xl font-bold text-white mb-3">심사 내역 (상세)</h2>
                                    <DetailSection />
                                </div>
                                <div className="lg:col-span-1 border border-gray-700 rounded-lg p-3">
                                    <h2 className="text-xl font-bold text-white mb-3">심사 결과</h2>
                                    <ResultSection />
                                </div>
                                <div className="lg:col-span-1 border border-gray-700 rounded-lg p-3">
                                    <h2 className="text-xl font-bold text-white mb-3">진단 정보</h2>
                                    <DiagnosisSection />
                                </div>
                            </div>
                        </div>
                    </main>

                    {/* Footer / Summary */}
                    <footer className="p-3 bg-gray-900 border-t border-gray-700 text-xs text-center text-gray-400">
                        <p>본 심사 결과는 예측 분석 자료이므로, 청구 전 반드시 관련 심사 담당자에게 문의하시기 바랍니다.</p>
                    </footer>
                </div>
            );
        };

        // React 앱 렌더링
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
